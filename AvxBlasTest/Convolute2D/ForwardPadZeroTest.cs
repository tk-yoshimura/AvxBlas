using AvxBlas;
using Microsoft.VisualStudio.TestTools.UnitTesting;
using System;
using System.Linq;

namespace AvxBlasTest.Convolute2DTest {
    [TestClass]
    public class ForwardPadZeroTest {
        [TestMethod]
        public void SForwardTest() {
            float max_err = 0;

            foreach (uint n in new int[] { 1, 2 }) {
                foreach ((uint iw, uint ih) in new (uint, uint)[] { (1, 1), (1, 4), (4, 1), (2, 3), (5, 8), (7, 6), (16, 15), (17, 28), (32, 30) }) {
                    foreach ((uint kw, uint kh) in new (uint, uint)[] { (1, 3), (3, 1), (3, 3), (3, 5), (5, 3), (7, 7) }) {
                        uint ow = iw, oh = ih;

                        foreach ((uint ic, uint oc) in new (uint, uint)[] { (1, 1), (2, 3), (3, 2), (4, 5), (5, 4), (8, 10), (10, 8),
                                                                            (7, 16), (16, 7), (9, 24), (24, 9), (31, 32), (32, 31), (43, 48), (48, 43), (15, 64), (64, 15) }) {

                            float[] xval = (new float[ic * iw * ih * n]).Select((_, idx) => (idx + 1) * 1e-3f).ToArray();
                            float[] wval = (new float[ic * oc * kw * kh]).Select((_, idx) => (idx + 1) * 1e-3f).Reverse().ToArray();

                            Map2D x = new((int)ic, (int)iw, (int)ih, (int)n, xval);
                            Filter2D w = new((int)ic, (int)kw, (int)kh, (int)oc, wval);

                            Map2D y = Reference(x, w, (int)kw, (int)kh);

                            Array<float> x_tensor = xval;
                            Array<float> w_tensor = wval;
                            Array<float> y_tensor = new(oc * ow * oh * n, zeroset: false);

                            Convolute2D.Forward(n, ic, oc, iw, ih, kw, kh, PadMode.Zero, x_tensor, w_tensor, y_tensor);

                            float[] y_expect = y.ToFloatArray();
                            float[] y_actual = y_tensor;

                            CollectionAssert.AreEqual(xval, (float[])x_tensor);
                            CollectionAssert.AreEqual(wval, (float[])w_tensor);

                            AssertError.Tolerance(y_expect, y_actual, 1e-10f, 1e-5f, ref max_err, $"NG: {ic},{oc},{iw},{ih},{kw},{kh},{n}");

                            Console.WriteLine($"OK: {ic},{oc},{iw},{ih},{kw},{kh},{n}");
                        }
                    }
                }
            }

            Console.WriteLine($"maxerr:{max_err}");
        }

        public static Map2D Reference(Map2D x, Filter2D w, int kw, int kh) {
            int inchannels = x.Channels, outchannels = w.OutChannels, batch = x.Batch;
            int iw = x.Width, ow = iw, ih = x.Height, oh = ih;

            Map2D y = new(outchannels, ow, oh, batch);

            for (int th = 0; th < batch; th++) {
                for (int ky = 0; ky < kh; ky++) {
                    for (int kx = 0; kx < kw; kx++) {
                        for (int oy = 0; oy < oh; oy++) {
                            int iy = ky + oy - kh / 2;

                            for (int ox = 0; ox < ow; ox++) {
                                int ix = kx + ox - kw / 2;

                                for (int outch = 0; outch < outchannels; outch++) {
                                    double sum = y[outch, ox, oy, th];

                                    for (int inch = 0; inch < inchannels; inch++) {
                                        double xv = (ix >= 0 && ix < iw && iy >= 0 && iy < ih) ? x[inch, ix, iy, th] : 0;

                                        sum += xv * w[inch, kx, ky, outch];
                                    }

                                    y[outch, ox, oy, th] = sum;
                                }
                            }
                        }
                    }
                }
            }

            return y;
        }

        [TestMethod]
        public void ReferenceTest() {
            int inchannels = 4, outchannels = 6;
            int kwidth = 3, kheight = 5, inwidth = 9, inheight = 13, batch = 2;

            float[] xval = (new float[batch * inwidth * inheight * inchannels]).Select((_, idx) => idx * 1e-3f).ToArray();
            float[] wval = (new float[kwidth * kheight * outchannels * inchannels]).Select((_, idx) => idx * 1e-3f).Reverse().ToArray();

            Map2D x = new(inchannels, inwidth, inheight, batch, xval);
            Filter2D w = new(inchannels, kwidth, kheight, outchannels, wval);

            Map2D y = Reference(x, w, kwidth, kheight);

            float[] y_expect = {
                2.920560000e-01f, 2.351760000e-01f, 1.782960000e-01f, 1.214160000e-01f, 6.453600000e-02f, 7.656000000e-03f, 4.635480000e-01f, 3.739080000e-01f, 2.842680000e-01f, 1.946280000e-01f, 1.049880000e-01f, 1.534800000e-02f,
                5.092680000e-01f, 4.109880000e-01f, 3.127080000e-01f, 2.144280000e-01f, 1.161480000e-01f, 1.786800000e-02f, 5.549880000e-01f, 4.480680000e-01f, 3.411480000e-01f, 2.342280000e-01f, 1.273080000e-01f, 2.038800000e-02f,
                6.007080000e-01f, 4.851480000e-01f, 3.695880000e-01f, 2.540280000e-01f, 1.384680000e-01f, 2.290800000e-02f, 6.464280000e-01f, 5.222280000e-01f, 3.980280000e-01f, 2.738280000e-01f, 1.496280000e-01f, 2.542800000e-02f,
                6.921480000e-01f, 5.593080000e-01f, 4.264680000e-01f, 2.936280000e-01f, 1.607880000e-01f, 2.794800000e-02f, 7.378680000e-01f, 5.963880000e-01f, 4.549080000e-01f, 3.134280000e-01f, 1.719480000e-01f, 3.046800000e-02f,
                5.105520000e-01f, 4.133520000e-01f, 3.161520000e-01f, 2.189520000e-01f, 1.217520000e-01f, 2.455200000e-02f, 5.741120000e-01f, 4.637120000e-01f, 3.533120000e-01f, 2.429120000e-01f, 1.325120000e-01f, 2.211200000e-02f,
                8.974240000e-01f, 7.260640000e-01f, 5.547040000e-01f, 3.833440000e-01f, 2.119840000e-01f, 4.062400000e-02f, 9.595360000e-01f, 7.766560000e-01f, 5.937760000e-01f, 4.108960000e-01f, 2.280160000e-01f, 4.513600000e-02f,
                1.021648000e+00f, 8.272480000e-01f, 6.328480000e-01f, 4.384480000e-01f, 2.440480000e-01f, 4.964800000e-02f, 1.083760000e+00f, 8.778400000e-01f, 6.719200000e-01f, 4.660000000e-01f, 2.600800000e-01f, 5.416000000e-02f,
                1.145872000e+00f, 9.284320000e-01f, 7.109920000e-01f, 4.935520000e-01f, 2.761120000e-01f, 5.867200000e-02f, 1.207984000e+00f, 9.790240000e-01f, 7.500640000e-01f, 5.211040000e-01f, 2.921440000e-01f, 6.318400000e-02f,
                1.270096000e+00f, 1.029616000e+00f, 7.891360000e-01f, 5.486560000e-01f, 3.081760000e-01f, 6.769600000e-02f, 8.731200000e-01f, 7.089600000e-01f, 5.448000000e-01f, 3.806400000e-01f, 2.164800000e-01f, 5.232000000e-02f,
                9.542800000e-01f, 7.730800000e-01f, 5.918800000e-01f, 4.106800000e-01f, 2.294800000e-01f, 4.828000000e-02f, 1.479620000e+00f, 1.200620000e+00f, 9.216200000e-01f, 6.426200000e-01f, 3.636200000e-01f, 8.462000000e-02f,
                1.558700000e+00f, 1.265300000e+00f, 9.719000000e-01f, 6.785000000e-01f, 3.851000000e-01f, 9.170000000e-02f, 1.637780000e+00f, 1.329980000e+00f, 1.022180000e+00f, 7.143800000e-01f, 4.065800000e-01f, 9.878000000e-02f,
                1.716860000e+00f, 1.394660000e+00f, 1.072460000e+00f, 7.502600000e-01f, 4.280600000e-01f, 1.058600000e-01f, 1.795940000e+00f, 1.459340000e+00f, 1.122740000e+00f, 7.861400000e-01f, 4.495400000e-01f, 1.129400000e-01f,
                1.875020000e+00f, 1.524020000e+00f, 1.173020000e+00f, 8.220200000e-01f, 4.710200000e-01f, 1.200200000e-01f, 1.954100000e+00f, 1.588700000e+00f, 1.223300000e+00f, 8.579000000e-01f, 4.925000000e-01f, 1.271000000e-01f,
                1.337640000e+00f, 1.089240000e+00f, 8.408400000e-01f, 5.924400000e-01f, 3.440400000e-01f, 9.564000000e-02f, 1.425880000e+00f, 1.158280000e+00f, 8.906800000e-01f, 6.230800000e-01f, 3.554800000e-01f, 8.788000000e-02f,
                2.191340000e+00f, 1.782740000e+00f, 1.374140000e+00f, 9.655400000e-01f, 5.569400000e-01f, 1.483400000e-01f, 2.270420000e+00f, 1.847420000e+00f, 1.424420000e+00f, 1.001420000e+00f, 5.784200000e-01f, 1.554200000e-01f,
                2.349500000e+00f, 1.912100000e+00f, 1.474700000e+00f, 1.037300000e+00f, 5.999000000e-01f, 1.625000000e-01f, 2.428580000e+00f, 1.976780000e+00f, 1.524980000e+00f, 1.073180000e+00f, 6.213800000e-01f, 1.695800000e-01f,
                2.507660000e+00f, 2.041460000e+00f, 1.575260000e+00f, 1.109060000e+00f, 6.428600000e-01f, 1.766600000e-01f, 2.586740000e+00f, 2.106140000e+00f, 1.625540000e+00f, 1.144940000e+00f, 6.643400000e-01f, 1.837400000e-01f,
                2.665820000e+00f, 2.170820000e+00f, 1.675820000e+00f, 1.180820000e+00f, 6.858200000e-01f, 1.908200000e-01f, 1.815000000e+00f, 1.480200000e+00f, 1.145400000e+00f, 8.106000000e-01f, 4.758000000e-01f, 1.410000000e-01f,
                1.897480000e+00f, 1.543480000e+00f, 1.189480000e+00f, 8.354800000e-01f, 4.814800000e-01f, 1.274800000e-01f, 2.903060000e+00f, 2.364860000e+00f, 1.826660000e+00f, 1.288460000e+00f, 7.502600000e-01f, 2.120600000e-01f,
                2.982140000e+00f, 2.429540000e+00f, 1.876940000e+00f, 1.324340000e+00f, 7.717400000e-01f, 2.191400000e-01f, 3.061220000e+00f, 2.494220000e+00f, 1.927220000e+00f, 1.360220000e+00f, 7.932200000e-01f, 2.262200000e-01f,
                3.140300000e+00f, 2.558900000e+00f, 1.977500000e+00f, 1.396100000e+00f, 8.147000000e-01f, 2.333000000e-01f, 3.219380000e+00f, 2.623580000e+00f, 2.027780000e+00f, 1.431980000e+00f, 8.361800000e-01f, 2.403800000e-01f,
                3.298460000e+00f, 2.688260000e+00f, 2.078060000e+00f, 1.467860000e+00f, 8.576600000e-01f, 2.474600000e-01f, 3.377540000e+00f, 2.752940000e+00f, 2.128340000e+00f, 1.503740000e+00f, 8.791400000e-01f, 2.545400000e-01f,
                2.292360000e+00f, 1.871160000e+00f, 1.449960000e+00f, 1.028760000e+00f, 6.075600000e-01f, 1.863600000e-01f, 2.369080000e+00f, 1.928680000e+00f, 1.488280000e+00f, 1.047880000e+00f, 6.074800000e-01f, 1.670800000e-01f,
                3.614780000e+00f, 2.946980000e+00f, 2.279180000e+00f, 1.611380000e+00f, 9.435800000e-01f, 2.757800000e-01f, 3.693860000e+00f, 3.011660000e+00f, 2.329460000e+00f, 1.647260000e+00f, 9.650600000e-01f, 2.828600000e-01f,
                3.772940000e+00f, 3.076340000e+00f, 2.379740000e+00f, 1.683140000e+00f, 9.865400000e-01f, 2.899400000e-01f, 3.852020000e+00f, 3.141020000e+00f, 2.430020000e+00f, 1.719020000e+00f, 1.008020000e+00f, 2.970200000e-01f,
                3.931100000e+00f, 3.205700000e+00f, 2.480300000e+00f, 1.754900000e+00f, 1.029500000e+00f, 3.041000000e-01f, 4.010180000e+00f, 3.270380000e+00f, 2.530580000e+00f, 1.790780000e+00f, 1.050980000e+00f, 3.111800000e-01f,
                4.089260000e+00f, 3.335060000e+00f, 2.580860000e+00f, 1.826660000e+00f, 1.072460000e+00f, 3.182600000e-01f, 2.769720000e+00f, 2.262120000e+00f, 1.754520000e+00f, 1.246920000e+00f, 7.393200000e-01f, 2.317200000e-01f,
                2.840680000e+00f, 2.313880000e+00f, 1.787080000e+00f, 1.260280000e+00f, 7.334800000e-01f, 2.066800000e-01f, 4.326500000e+00f, 3.529100000e+00f, 2.731700000e+00f, 1.934300000e+00f, 1.136900000e+00f, 3.395000000e-01f,
                4.405580000e+00f, 3.593780000e+00f, 2.781980000e+00f, 1.970180000e+00f, 1.158380000e+00f, 3.465800000e-01f, 4.484660000e+00f, 3.658460000e+00f, 2.832260000e+00f, 2.006060000e+00f, 1.179860000e+00f, 3.536600000e-01f,
                4.563740000e+00f, 3.723140000e+00f, 2.882540000e+00f, 2.041940000e+00f, 1.201340000e+00f, 3.607400000e-01f, 4.642820000e+00f, 3.787820000e+00f, 2.932820000e+00f, 2.077820000e+00f, 1.222820000e+00f, 3.678200000e-01f,
                4.721900000e+00f, 3.852500000e+00f, 2.983100000e+00f, 2.113700000e+00f, 1.244300000e+00f, 3.749000000e-01f, 4.800980000e+00f, 3.917180000e+00f, 3.033380000e+00f, 2.149580000e+00f, 1.265780000e+00f, 3.819800000e-01f,
                3.247080000e+00f, 2.653080000e+00f, 2.059080000e+00f, 1.465080000e+00f, 8.710800000e-01f, 2.770800000e-01f, 3.312280000e+00f, 2.699080000e+00f, 2.085880000e+00f, 1.472680000e+00f, 8.594800000e-01f, 2.462800000e-01f,
                5.038220000e+00f, 4.111220000e+00f, 3.184220000e+00f, 2.257220000e+00f, 1.330220000e+00f, 4.032200000e-01f, 5.117300000e+00f, 4.175900000e+00f, 3.234500000e+00f, 2.293100000e+00f, 1.351700000e+00f, 4.103000000e-01f,
                5.196380000e+00f, 4.240580000e+00f, 3.284780000e+00f, 2.328980000e+00f, 1.373180000e+00f, 4.173800000e-01f, 5.275460000e+00f, 4.305260000e+00f, 3.335060000e+00f, 2.364860000e+00f, 1.394660000e+00f, 4.244600000e-01f,
                5.354540000e+00f, 4.369940000e+00f, 3.385340000e+00f, 2.400740000e+00f, 1.416140000e+00f, 4.315400000e-01f, 5.433620000e+00f, 4.434620000e+00f, 3.435620000e+00f, 2.436620000e+00f, 1.437620000e+00f, 4.386200000e-01f,
                5.512700000e+00f, 4.499300000e+00f, 3.485900000e+00f, 2.472500000e+00f, 1.459100000e+00f, 4.457000000e-01f, 3.724440000e+00f, 3.044040000e+00f, 2.363640000e+00f, 1.683240000e+00f, 1.002840000e+00f, 3.224400000e-01f,
                3.783880000e+00f, 3.084280000e+00f, 2.384680000e+00f, 1.685080000e+00f, 9.854800000e-01f, 2.858800000e-01f, 5.749940000e+00f, 4.693340000e+00f, 3.636740000e+00f, 2.580140000e+00f, 1.523540000e+00f, 4.669400000e-01f,
                5.829020000e+00f, 4.758020000e+00f, 3.687020000e+00f, 2.616020000e+00f, 1.545020000e+00f, 4.740200000e-01f, 5.908100000e+00f, 4.822700000e+00f, 3.737300000e+00f, 2.651900000e+00f, 1.566500000e+00f, 4.811000000e-01f,
                5.987180000e+00f, 4.887380000e+00f, 3.787580000e+00f, 2.687780000e+00f, 1.587980000e+00f, 4.881800000e-01f, 6.066260000e+00f, 4.952060000e+00f, 3.837860000e+00f, 2.723660000e+00f, 1.609460000e+00f, 4.952600000e-01f,
                6.145340000e+00f, 5.016740000e+00f, 3.888140000e+00f, 2.759540000e+00f, 1.630940000e+00f, 5.023400000e-01f, 6.224420000e+00f, 5.081420000e+00f, 3.938420000e+00f, 2.795420000e+00f, 1.652420000e+00f, 5.094200000e-01f,
                4.201800000e+00f, 3.435000000e+00f, 2.668200000e+00f, 1.901400000e+00f, 1.134600000e+00f, 3.678000000e-01f, 4.255480000e+00f, 3.469480000e+00f, 2.683480000e+00f, 1.897480000e+00f, 1.111480000e+00f, 3.254800000e-01f,
                6.461660000e+00f, 5.275460000e+00f, 4.089260000e+00f, 2.903060000e+00f, 1.716860000e+00f, 5.306600000e-01f, 6.540740000e+00f, 5.340140000e+00f, 4.139540000e+00f, 2.938940000e+00f, 1.738340000e+00f, 5.377400000e-01f,
                6.619820000e+00f, 5.404820000e+00f, 4.189820000e+00f, 2.974820000e+00f, 1.759820000e+00f, 5.448200000e-01f, 6.698900000e+00f, 5.469500000e+00f, 4.240100000e+00f, 3.010700000e+00f, 1.781300000e+00f, 5.519000000e-01f,
                6.777980000e+00f, 5.534180000e+00f, 4.290380000e+00f, 3.046580000e+00f, 1.802780000e+00f, 5.589800000e-01f, 6.857060000e+00f, 5.598860000e+00f, 4.340660000e+00f, 3.082460000e+00f, 1.824260000e+00f, 5.660600000e-01f,
                6.936140000e+00f, 5.663540000e+00f, 4.390940000e+00f, 3.118340000e+00f, 1.845740000e+00f, 5.731400000e-01f, 4.679160000e+00f, 3.825960000e+00f, 2.972760000e+00f, 2.119560000e+00f, 1.266360000e+00f, 4.131600000e-01f,
                4.727080000e+00f, 3.854680000e+00f, 2.982280000e+00f, 2.109880000e+00f, 1.237480000e+00f, 3.650800000e-01f, 7.173380000e+00f, 5.857580000e+00f, 4.541780000e+00f, 3.225980000e+00f, 1.910180000e+00f, 5.943800000e-01f,
                7.252460000e+00f, 5.922260000e+00f, 4.592060000e+00f, 3.261860000e+00f, 1.931660000e+00f, 6.014600000e-01f, 7.331540000e+00f, 5.986940000e+00f, 4.642340000e+00f, 3.297740000e+00f, 1.953140000e+00f, 6.085400000e-01f,
                7.410620000e+00f, 6.051620000e+00f, 4.692620000e+00f, 3.333620000e+00f, 1.974620000e+00f, 6.156200000e-01f, 7.489700000e+00f, 6.116300000e+00f, 4.742900000e+00f, 3.369500000e+00f, 1.996100000e+00f, 6.227000000e-01f,
                7.568780000e+00f, 6.180980000e+00f, 4.793180000e+00f, 3.405380000e+00f, 2.017580000e+00f, 6.297800000e-01f, 7.647860000e+00f, 6.245660000e+00f, 4.843460000e+00f, 3.441260000e+00f, 2.039060000e+00f, 6.368600000e-01f,
                5.156520000e+00f, 4.216920000e+00f, 3.277320000e+00f, 2.337720000e+00f, 1.398120000e+00f, 4.585200000e-01f, 4.053920000e+00f, 3.321440000e+00f, 2.588960000e+00f, 1.856480000e+00f, 1.124000000e+00f, 3.915200000e-01f,
                6.149392000e+00f, 5.044912000e+00f, 3.940432000e+00f, 2.835952000e+00f, 1.731472000e+00f, 6.269920000e-01f, 6.213808000e+00f, 5.097808000e+00f, 3.981808000e+00f, 2.865808000e+00f, 1.749808000e+00f, 6.338080000e-01f,
                6.278224000e+00f, 5.150704000e+00f, 4.023184000e+00f, 2.895664000e+00f, 1.768144000e+00f, 6.406240000e-01f, 6.342640000e+00f, 5.203600000e+00f, 4.064560000e+00f, 2.925520000e+00f, 1.786480000e+00f, 6.474400000e-01f,
                6.407056000e+00f, 5.256496000e+00f, 4.105936000e+00f, 2.955376000e+00f, 1.804816000e+00f, 6.542560000e-01f, 6.471472000e+00f, 5.309392000e+00f, 4.147312000e+00f, 2.985232000e+00f, 1.823152000e+00f, 6.610720000e-01f,
                6.535888000e+00f, 5.362288000e+00f, 4.188688000e+00f, 3.015088000e+00f, 1.841488000e+00f, 6.678880000e-01f, 4.405152000e+00f, 3.618912000e+00f, 2.832672000e+00f, 2.046432000e+00f, 1.260192000e+00f, 4.739520000e-01f,
                3.248088000e+00f, 2.672808000e+00f, 2.097528000e+00f, 1.522248000e+00f, 9.469680000e-01f, 3.716880000e-01f, 4.925244000e+00f, 4.058004000e+00f, 3.190764000e+00f, 2.323524000e+00f, 1.456284000e+00f, 5.890440000e-01f,
                4.974420000e+00f, 4.098540000e+00f, 3.222660000e+00f, 2.346780000e+00f, 1.470900000e+00f, 5.950200000e-01f, 5.023596000e+00f, 4.139076000e+00f, 3.254556000e+00f, 2.370036000e+00f, 1.485516000e+00f, 6.009960000e-01f,
                5.072772000e+00f, 4.179612000e+00f, 3.286452000e+00f, 2.393292000e+00f, 1.500132000e+00f, 6.069720000e-01f, 5.121948000e+00f, 4.220148000e+00f, 3.318348000e+00f, 2.416548000e+00f, 1.514748000e+00f, 6.129480000e-01f,
                5.171124000e+00f, 4.260684000e+00f, 3.350244000e+00f, 2.439804000e+00f, 1.529364000e+00f, 6.189240000e-01f, 5.220300000e+00f, 4.301220000e+00f, 3.382140000e+00f, 2.463060000e+00f, 1.543980000e+00f, 6.249000000e-01f,
                3.517272000e+00f, 2.901672000e+00f, 2.286072000e+00f, 1.670472000e+00f, 1.054872000e+00f, 4.392720000e-01f, 3.835752000e+00f, 3.104952000e+00f, 2.374152000e+00f, 1.643352000e+00f, 9.125520000e-01f, 1.817520000e-01f,
                5.812788000e+00f, 4.712268000e+00f, 3.611748000e+00f, 2.511228000e+00f, 1.410708000e+00f, 3.101880000e-01f, 5.858508000e+00f, 4.749348000e+00f, 3.640188000e+00f, 2.531028000e+00f, 1.421868000e+00f, 3.127080000e-01f,
                5.904228000e+00f, 4.786428000e+00f, 3.668628000e+00f, 2.550828000e+00f, 1.433028000e+00f, 3.152280000e-01f, 5.949948000e+00f, 4.823508000e+00f, 3.697068000e+00f, 2.570628000e+00f, 1.444188000e+00f, 3.177480000e-01f,
                5.995668000e+00f, 4.860588000e+00f, 3.725508000e+00f, 2.590428000e+00f, 1.455348000e+00f, 3.202680000e-01f, 6.041388000e+00f, 4.897668000e+00f, 3.753948000e+00f, 2.610228000e+00f, 1.466508000e+00f, 3.227880000e-01f,
                6.087108000e+00f, 4.934748000e+00f, 3.782388000e+00f, 2.630028000e+00f, 1.477668000e+00f, 3.253080000e-01f, 4.099176000e+00f, 3.328056000e+00f, 2.556936000e+00f, 1.785816000e+00f, 1.014696000e+00f, 2.435760000e-01f,
                5.388896000e+00f, 4.379936000e+00f, 3.370976000e+00f, 2.362016000e+00f, 1.353056000e+00f, 3.440960000e-01f, 8.164528000e+00f, 6.645328000e+00f, 5.126128000e+00f, 3.606928000e+00f, 2.087728000e+00f, 5.685280000e-01f,
                8.226640000e+00f, 6.695920000e+00f, 5.165200000e+00f, 3.634480000e+00f, 2.103760000e+00f, 5.730400000e-01f, 8.288752000e+00f, 6.746512000e+00f, 5.204272000e+00f, 3.662032000e+00f, 2.119792000e+00f, 5.775520000e-01f,
                8.350864000e+00f, 6.797104000e+00f, 5.243344000e+00f, 3.689584000e+00f, 2.135824000e+00f, 5.820640000e-01f, 8.412976000e+00f, 6.847696000e+00f, 5.282416000e+00f, 3.717136000e+00f, 2.151856000e+00f, 5.865760000e-01f,
                8.475088000e+00f, 6.898288000e+00f, 5.321488000e+00f, 3.744688000e+00f, 2.167888000e+00f, 5.910880000e-01f, 8.537200000e+00f, 6.948880000e+00f, 5.360560000e+00f, 3.772240000e+00f, 2.183920000e+00f, 5.956000000e-01f,
                5.747808000e+00f, 4.685088000e+00f, 3.622368000e+00f, 2.559648000e+00f, 1.496928000e+00f, 4.342080000e-01f, 7.085080000e+00f, 5.780680000e+00f, 4.476280000e+00f, 3.171880000e+00f, 1.867480000e+00f, 5.630800000e-01f,
                1.073198000e+01f, 8.768180000e+00f, 6.804380000e+00f, 4.840580000e+00f, 2.876780000e+00f, 9.129800000e-01f, 1.081106000e+01f, 8.832860000e+00f, 6.854660000e+00f, 4.876460000e+00f, 2.898260000e+00f, 9.200600000e-01f,
                1.089014000e+01f, 8.897540000e+00f, 6.904940000e+00f, 4.912340000e+00f, 2.919740000e+00f, 9.271400000e-01f, 1.096922000e+01f, 8.962220000e+00f, 6.955220000e+00f, 4.948220000e+00f, 2.941220000e+00f, 9.342200000e-01f,
                1.104830000e+01f, 9.026900000e+00f, 7.005500000e+00f, 4.984100000e+00f, 2.962700000e+00f, 9.413000000e-01f, 1.112738000e+01f, 9.091580000e+00f, 7.055780000e+00f, 5.019980000e+00f, 2.984180000e+00f, 9.483800000e-01f,
                1.120646000e+01f, 9.156260000e+00f, 7.106060000e+00f, 5.055860000e+00f, 3.005660000e+00f, 9.554600000e-01f, 7.543320000e+00f, 6.171720000e+00f, 4.800120000e+00f, 3.428520000e+00f, 2.056920000e+00f, 6.853200000e-01f,
                7.556680000e+00f, 6.165880000e+00f, 4.775080000e+00f, 3.384280000e+00f, 1.993480000e+00f, 6.026800000e-01f, 1.144370000e+01f, 9.350300000e+00f, 7.256900000e+00f, 5.163500000e+00f, 3.070100000e+00f, 9.767000000e-01f,
                1.152278000e+01f, 9.414980000e+00f, 7.307180000e+00f, 5.199380000e+00f, 3.091580000e+00f, 9.837800000e-01f, 1.160186000e+01f, 9.479660000e+00f, 7.357460000e+00f, 5.235260000e+00f, 3.113060000e+00f, 9.908600000e-01f,
                1.168094000e+01f, 9.544340000e+00f, 7.407740000e+00f, 5.271140000e+00f, 3.134540000e+00f, 9.979400000e-01f, 1.176002000e+01f, 9.609020000e+00f, 7.458020000e+00f, 5.307020000e+00f, 3.156020000e+00f, 1.005020000e+00f,
                1.183910000e+01f, 9.673700000e+00f, 7.508300000e+00f, 5.342900000e+00f, 3.177500000e+00f, 1.012100000e+00f, 1.191818000e+01f, 9.738380000e+00f, 7.558580000e+00f, 5.378780000e+00f, 3.198980000e+00f, 1.019180000e+00f,
                8.020680000e+00f, 6.562680000e+00f, 5.104680000e+00f, 3.646680000e+00f, 2.188680000e+00f, 7.306800000e-01f, 8.028280000e+00f, 6.551080000e+00f, 5.073880000e+00f, 3.596680000e+00f, 2.119480000e+00f, 6.422800000e-01f,
                1.215542000e+01f, 9.932420000e+00f, 7.709420000e+00f, 5.486420000e+00f, 3.263420000e+00f, 1.040420000e+00f, 1.223450000e+01f, 9.997100000e+00f, 7.759700000e+00f, 5.522300000e+00f, 3.284900000e+00f, 1.047500000e+00f,
                1.231358000e+01f, 1.006178000e+01f, 7.809980000e+00f, 5.558180000e+00f, 3.306380000e+00f, 1.054580000e+00f, 1.239266000e+01f, 1.012646000e+01f, 7.860260000e+00f, 5.594060000e+00f, 3.327860000e+00f, 1.061660000e+00f,
                1.247174000e+01f, 1.019114000e+01f, 7.910540000e+00f, 5.629940000e+00f, 3.349340000e+00f, 1.068740000e+00f, 1.255082000e+01f, 1.025582000e+01f, 7.960820000e+00f, 5.665820000e+00f, 3.370820000e+00f, 1.075820000e+00f,
                1.262990000e+01f, 1.032050000e+01f, 8.011100000e+00f, 5.701700000e+00f, 3.392300000e+00f, 1.082900000e+00f, 8.498040000e+00f, 6.953640000e+00f, 5.409240000e+00f, 3.864840000e+00f, 2.320440000e+00f, 7.760400000e-01f,
                8.499880000e+00f, 6.936280000e+00f, 5.372680000e+00f, 3.809080000e+00f, 2.245480000e+00f, 6.818800000e-01f, 1.286714000e+01f, 1.051454000e+01f, 8.161940000e+00f, 5.809340000e+00f, 3.456740000e+00f, 1.104140000e+00f,
                1.294622000e+01f, 1.057922000e+01f, 8.212220000e+00f, 5.845220000e+00f, 3.478220000e+00f, 1.111220000e+00f, 1.302530000e+01f, 1.064390000e+01f, 8.262500000e+00f, 5.881100000e+00f, 3.499700000e+00f, 1.118300000e+00f,
                1.310438000e+01f, 1.070858000e+01f, 8.312780000e+00f, 5.916980000e+00f, 3.521180000e+00f, 1.125380000e+00f, 1.318346000e+01f, 1.077326000e+01f, 8.363060000e+00f, 5.952860000e+00f, 3.542660000e+00f, 1.132460000e+00f,
                1.326254000e+01f, 1.083794000e+01f, 8.413340000e+00f, 5.988740000e+00f, 3.564140000e+00f, 1.139540000e+00f, 1.334162000e+01f, 1.090262000e+01f, 8.463620000e+00f, 6.024620000e+00f, 3.585620000e+00f, 1.146620000e+00f,
                8.975400000e+00f, 7.344600000e+00f, 5.713800000e+00f, 4.083000000e+00f, 2.452200000e+00f, 8.214000000e-01f, 8.971480000e+00f, 7.321480000e+00f, 5.671480000e+00f, 4.021480000e+00f, 2.371480000e+00f, 7.214800000e-01f,
                1.357886000e+01f, 1.109666000e+01f, 8.614460000e+00f, 6.132260000e+00f, 3.650060000e+00f, 1.167860000e+00f, 1.365794000e+01f, 1.116134000e+01f, 8.664740000e+00f, 6.168140000e+00f, 3.671540000e+00f, 1.174940000e+00f,
                1.373702000e+01f, 1.122602000e+01f, 8.715020000e+00f, 6.204020000e+00f, 3.693020000e+00f, 1.182020000e+00f, 1.381610000e+01f, 1.129070000e+01f, 8.765300000e+00f, 6.239900000e+00f, 3.714500000e+00f, 1.189100000e+00f,
                1.389518000e+01f, 1.135538000e+01f, 8.815580000e+00f, 6.275780000e+00f, 3.735980000e+00f, 1.196180000e+00f, 1.397426000e+01f, 1.142006000e+01f, 8.865860000e+00f, 6.311660000e+00f, 3.757460000e+00f, 1.203260000e+00f,
                1.405334000e+01f, 1.148474000e+01f, 8.916140000e+00f, 6.347540000e+00f, 3.778940000e+00f, 1.210340000e+00f, 9.452760000e+00f, 7.735560000e+00f, 6.018360000e+00f, 4.301160000e+00f, 2.583960000e+00f, 8.667600000e-01f,
                9.443080000e+00f, 7.706680000e+00f, 5.970280000e+00f, 4.233880000e+00f, 2.497480000e+00f, 7.610800000e-01f, 1.429058000e+01f, 1.167878000e+01f, 9.066980000e+00f, 6.455180000e+00f, 3.843380000e+00f, 1.231580000e+00f,
                1.436966000e+01f, 1.174346000e+01f, 9.117260000e+00f, 6.491060000e+00f, 3.864860000e+00f, 1.238660000e+00f, 1.444874000e+01f, 1.180814000e+01f, 9.167540000e+00f, 6.526940000e+00f, 3.886340000e+00f, 1.245740000e+00f,
                1.452782000e+01f, 1.187282000e+01f, 9.217820000e+00f, 6.562820000e+00f, 3.907820000e+00f, 1.252820000e+00f, 1.460690000e+01f, 1.193750000e+01f, 9.268100000e+00f, 6.598700000e+00f, 3.929300000e+00f, 1.259900000e+00f,
                1.468598000e+01f, 1.200218000e+01f, 9.318380000e+00f, 6.634580000e+00f, 3.950780000e+00f, 1.266980000e+00f, 1.476506000e+01f, 1.206686000e+01f, 9.368660000e+00f, 6.670460000e+00f, 3.972260000e+00f, 1.274060000e+00f,
                9.930120000e+00f, 8.126520000e+00f, 6.322920000e+00f, 4.519320000e+00f, 2.715720000e+00f, 9.121200000e-01f, 9.914680000e+00f, 8.091880000e+00f, 6.269080000e+00f, 4.446280000e+00f, 2.623480000e+00f, 8.006800000e-01f,
                1.500230000e+01f, 1.226090000e+01f, 9.519500000e+00f, 6.778100000e+00f, 4.036700000e+00f, 1.295300000e+00f, 1.508138000e+01f, 1.232558000e+01f, 9.569780000e+00f, 6.813980000e+00f, 4.058180000e+00f, 1.302380000e+00f,
                1.516046000e+01f, 1.239026000e+01f, 9.620060000e+00f, 6.849860000e+00f, 4.079660000e+00f, 1.309460000e+00f, 1.523954000e+01f, 1.245494000e+01f, 9.670340000e+00f, 6.885740000e+00f, 4.101140000e+00f, 1.316540000e+00f,
                1.531862000e+01f, 1.251962000e+01f, 9.720620000e+00f, 6.921620000e+00f, 4.122620000e+00f, 1.323620000e+00f, 1.539770000e+01f, 1.258430000e+01f, 9.770900000e+00f, 6.957500000e+00f, 4.144100000e+00f, 1.330700000e+00f,
                1.547678000e+01f, 1.264898000e+01f, 9.821180000e+00f, 6.993380000e+00f, 4.165580000e+00f, 1.337780000e+00f, 1.040748000e+01f, 8.517480000e+00f, 6.627480000e+00f, 4.737480000e+00f, 2.847480000e+00f, 9.574800000e-01f,
                1.038628000e+01f, 8.477080000e+00f, 6.567880000e+00f, 4.658680000e+00f, 2.749480000e+00f, 8.402800000e-01f, 1.571402000e+01f, 1.284302000e+01f, 9.972020000e+00f, 7.101020000e+00f, 4.230020000e+00f, 1.359020000e+00f,
                1.579310000e+01f, 1.290770000e+01f, 1.002230000e+01f, 7.136900000e+00f, 4.251500000e+00f, 1.366100000e+00f, 1.587218000e+01f, 1.297238000e+01f, 1.007258000e+01f, 7.172780000e+00f, 4.272980000e+00f, 1.373180000e+00f,
                1.595126000e+01f, 1.303706000e+01f, 1.012286000e+01f, 7.208660000e+00f, 4.294460000e+00f, 1.380260000e+00f, 1.603034000e+01f, 1.310174000e+01f, 1.017314000e+01f, 7.244540000e+00f, 4.315940000e+00f, 1.387340000e+00f,
                1.610942000e+01f, 1.316642000e+01f, 1.022342000e+01f, 7.280420000e+00f, 4.337420000e+00f, 1.394420000e+00f, 1.618850000e+01f, 1.323110000e+01f, 1.027370000e+01f, 7.316300000e+00f, 4.358900000e+00f, 1.401500000e+00f,
                1.088484000e+01f, 8.908440000e+00f, 6.932040000e+00f, 4.955640000e+00f, 2.979240000e+00f, 1.002840000e+00f, 1.085788000e+01f, 8.862280000e+00f, 6.866680000e+00f, 4.871080000e+00f, 2.875480000e+00f, 8.798800000e-01f,
                1.642574000e+01f, 1.342514000e+01f, 1.042454000e+01f, 7.423940000e+00f, 4.423340000e+00f, 1.422740000e+00f, 1.650482000e+01f, 1.348982000e+01f, 1.047482000e+01f, 7.459820000e+00f, 4.444820000e+00f, 1.429820000e+00f,
                1.658390000e+01f, 1.355450000e+01f, 1.052510000e+01f, 7.495700000e+00f, 4.466300000e+00f, 1.436900000e+00f, 1.666298000e+01f, 1.361918000e+01f, 1.057538000e+01f, 7.531580000e+00f, 4.487780000e+00f, 1.443980000e+00f,
                1.674206000e+01f, 1.368386000e+01f, 1.062566000e+01f, 7.567460000e+00f, 4.509260000e+00f, 1.451060000e+00f, 1.682114000e+01f, 1.374854000e+01f, 1.067594000e+01f, 7.603340000e+00f, 4.530740000e+00f, 1.458140000e+00f,
                1.690022000e+01f, 1.381322000e+01f, 1.072622000e+01f, 7.639220000e+00f, 4.552220000e+00f, 1.465220000e+00f, 1.136220000e+01f, 9.299400000e+00f, 7.236600000e+00f, 5.173800000e+00f, 3.111000000e+00f, 1.048200000e+00f,
                9.048416000e+00f, 7.417376000e+00f, 5.786336000e+00f, 4.155296000e+00f, 2.524256000e+00f, 8.932160000e-01f, 1.368606400e+01f, 1.123374400e+01f, 8.781424000e+00f, 6.329104000e+00f, 3.876784000e+00f, 1.424464000e+00f,
                1.375048000e+01f, 1.128664000e+01f, 8.822800000e+00f, 6.358960000e+00f, 3.895120000e+00f, 1.431280000e+00f, 1.381489600e+01f, 1.133953600e+01f, 8.864176000e+00f, 6.388816000e+00f, 3.913456000e+00f, 1.438096000e+00f,
                1.387931200e+01f, 1.139243200e+01f, 8.905552000e+00f, 6.418672000e+00f, 3.931792000e+00f, 1.444912000e+00f, 1.394372800e+01f, 1.144532800e+01f, 8.946928000e+00f, 6.448528000e+00f, 3.950128000e+00f, 1.451728000e+00f,
                1.400814400e+01f, 1.149822400e+01f, 8.988304000e+00f, 6.478384000e+00f, 3.968464000e+00f, 1.458544000e+00f, 1.407256000e+01f, 1.155112000e+01f, 9.029680000e+00f, 6.508240000e+00f, 3.986800000e+00f, 1.465360000e+00f,
                9.459552000e+00f, 7.774752000e+00f, 6.089952000e+00f, 4.405152000e+00f, 2.720352000e+00f, 1.035552000e+00f, 7.061352000e+00f, 5.812152000e+00f, 4.562952000e+00f, 3.313752000e+00f, 2.064552000e+00f, 8.153520000e-01f,
                1.067883600e+01f, 8.800716000e+00f, 6.922596000e+00f, 5.044476000e+00f, 3.166356000e+00f, 1.288236000e+00f, 1.072801200e+01f, 8.841252000e+00f, 6.954492000e+00f, 5.067732000e+00f, 3.180972000e+00f, 1.294212000e+00f,
                1.077718800e+01f, 8.881788000e+00f, 6.986388000e+00f, 5.090988000e+00f, 3.195588000e+00f, 1.300188000e+00f, 1.082636400e+01f, 8.922324000e+00f, 7.018284000e+00f, 5.114244000e+00f, 3.210204000e+00f, 1.306164000e+00f,
                1.087554000e+01f, 8.962860000e+00f, 7.050180000e+00f, 5.137500000e+00f, 3.224820000e+00f, 1.312140000e+00f, 1.092471600e+01f, 9.003396000e+00f, 7.082076000e+00f, 5.160756000e+00f, 3.239436000e+00f, 1.318116000e+00f,
                1.097389200e+01f, 9.043932000e+00f, 7.113972000e+00f, 5.184012000e+00f, 3.254052000e+00f, 1.324092000e+00f, 7.375464000e+00f, 6.085944000e+00f, 4.796424000e+00f, 3.506904000e+00f, 2.217384000e+00f, 9.278640000e-01f,

            };

            float[] y_actual = y.ToFloatArray();

            AssertError.Tolerance(y_expect, y_actual, 1e-10f, 1e-5f);
        }
    }
}
