using AvxBlas;
using Microsoft.VisualStudio.TestTools.UnitTesting;
using System;
using System.Linq;

namespace AvxBlasTest.Connection2DTest {
    [TestClass]
    public class ForwardPadEdgeTest {
        [TestMethod]
        public void SForwardTest() {
            float max_err = 0;

            foreach (uint n in new int[] { 1, 2 }) {
                foreach ((uint iw, uint ih) in new (uint, uint)[] { (1, 1), (1, 4), (4, 1), (4, 3), (5, 8), (16, 15), (17, 28), (32, 30) }) {
                    foreach ((uint kw, uint kh) in new (uint, uint)[] { (1, 3), (3, 1), (3, 3), (3, 5), (5, 3), (7, 7) }) {
                        uint ow = iw, oh = ih;

                        foreach ((uint ic, uint oc) in new (uint, uint)[] { (1, 1), (2, 3), (3, 2), (4, 5), (5, 4), (8, 10), (10, 8),
                                                                            (7, 16), (16, 7), (9, 24), (24, 9), (31, 32), (32, 31), (43, 48), (48, 43), (15, 64), (64, 15) }) {

                            float[] xval = (new float[ic * iw * ih * n]).Select((_, idx) => (idx + 1) * 1e-3f).ToArray();
                            float[] wval = (new float[ic * oc * kw * kh]).Select((_, idx) => (idx + 1) * 1e-3f).Reverse().ToArray();

                            Map2D x = new((int)ic, (int)iw, (int)ih, (int)n, xval);
                            Filter2D w = new((int)ic, (int)kw, (int)kh, (int)oc, wval);

                            Map2D y = Reference(x, w, (int)kw, (int)kh);

                            Array<float> x_tensor = xval;
                            Array<float> w_tensor = wval;
                            Array<float> y_tensor = new(oc * ow * oh * n, zeroset: false);

                            Convolution2D.Forward(n, ic, oc, iw, ih, kw, kh, PadMode.Edge, x_tensor, w_tensor, y_tensor);

                            float[] y_expect = y.ToFloatArray();
                            float[] y_actual = y_tensor;

                            CollectionAssert.AreEqual(xval, (float[])x_tensor);
                            CollectionAssert.AreEqual(wval, (float[])w_tensor);

                            AssertError.Tolerance(y_expect, y_actual, 1e-10f, 1e-5f, ref max_err, $"NG: {ic},{oc},{iw},{ih},{kw},{kh},{n}");

                            Console.WriteLine($"OK: {ic},{oc},{iw},{ih},{kw},{kh},{n}");
                        }
                    }
                }
            }

            Console.WriteLine($"maxerr:{max_err}");
        }

        public static Map2D Reference(Map2D x, Filter2D w, int kw, int kh) {
            int inchannels = x.Channels, outchannels = w.OutChannels, batch = x.Batch;
            int iw = x.Width, ow = iw, ih = x.Height, oh = ih;

            Map2D y = new(outchannels, ow, oh, batch);

            for (int th = 0; th < batch; th++) {
                for (int ky = 0; ky < kh; ky++) {
                    for (int kx = 0; kx < kw; kx++) {
                        for (int oy = 0; oy < oh; oy++) {
                            for (int ox = 0; ox < ow; ox++) {
                                int ix = Math.Min(iw - 1, Math.Max(0, kx + ox - kw / 2));
                                int iy = Math.Min(ih - 1, Math.Max(0, ky + oy - kh / 2));

                                for (int outch = 0; outch < outchannels; outch++) {
                                    double sum = y[outch, ox, oy, th];

                                    for (int inch = 0; inch < inchannels; inch++) {
                                        double xv = x[inch, ix, iy, th];

                                        sum += xv * w[inch, kx, ky, outch];
                                    }

                                    y[outch, ox, oy, th] = sum;
                                }
                            }
                        }
                    }
                }
            }

            return y;
        }

        [TestMethod]
        public void ReferenceTest() {
            int inchannels = 4, outchannels = 6;
            int kwidth = 3, kheight = 5, inwidth = 9, inheight = 13, batch = 2;

            float[] xval = (new float[batch * inwidth * inheight * inchannels]).Select((_, idx) => idx * 1e-3f).ToArray();
            float[] wval = (new float[kwidth * kheight * outchannels * inchannels]).Select((_, idx) => idx * 1e-3f).Reverse().ToArray();

            Map2D x = new(inchannels, inwidth, inheight, batch, xval);
            Filter2D w = new(inchannels, kwidth, kheight, outchannels, wval);

            Map2D y = Reference(x, w, kwidth, kheight);

            float[] y_expect = {
                4.567320000e-01f, 3.687720000e-01f, 2.808120000e-01f, 1.928520000e-01f, 1.048920000e-01f, 1.693200000e-02f, 5.091320000e-01f, 4.115720000e-01f, 3.140120000e-01f, 2.164520000e-01f, 1.188920000e-01f, 2.133200000e-02f,
                5.882120000e-01f, 4.762520000e-01f, 3.642920000e-01f, 2.523320000e-01f, 1.403720000e-01f, 2.841200000e-02f, 6.672920000e-01f, 5.409320000e-01f, 4.145720000e-01f, 2.882120000e-01f, 1.618520000e-01f, 3.549200000e-02f,
                7.463720000e-01f, 6.056120000e-01f, 4.648520000e-01f, 3.240920000e-01f, 1.833320000e-01f, 4.257200000e-02f, 8.254520000e-01f, 6.702920000e-01f, 5.151320000e-01f, 3.599720000e-01f, 2.048120000e-01f, 4.965200000e-02f,
                9.045320000e-01f, 7.349720000e-01f, 5.654120000e-01f, 3.958520000e-01f, 2.262920000e-01f, 5.673200000e-02f, 9.836120000e-01f, 7.996520000e-01f, 6.156920000e-01f, 4.317320000e-01f, 2.477720000e-01f, 6.381200000e-02f,
                1.036652000e+00f, 8.430920000e-01f, 6.495320000e-01f, 4.559720000e-01f, 2.624120000e-01f, 6.885200000e-02f, 8.682120000e-01f, 7.024920000e-01f, 5.367720000e-01f, 3.710520000e-01f, 2.053320000e-01f, 3.961200000e-02f,
                9.206120000e-01f, 7.452920000e-01f, 5.699720000e-01f, 3.946520000e-01f, 2.193320000e-01f, 4.401200000e-02f, 9.996920000e-01f, 8.099720000e-01f, 6.202520000e-01f, 4.305320000e-01f, 2.408120000e-01f, 5.109200000e-02f,
                1.078772000e+00f, 8.746520000e-01f, 6.705320000e-01f, 4.664120000e-01f, 2.622920000e-01f, 5.817200000e-02f, 1.157852000e+00f, 9.393320000e-01f, 7.208120000e-01f, 5.022920000e-01f, 2.837720000e-01f, 6.525200000e-02f,
                1.236932000e+00f, 1.004012000e+00f, 7.710920000e-01f, 5.381720000e-01f, 3.052520000e-01f, 7.233200000e-02f, 1.316012000e+00f, 1.068692000e+00f, 8.213720000e-01f, 5.740520000e-01f, 3.267320000e-01f, 7.941200000e-02f,
                1.395092000e+00f, 1.133372000e+00f, 8.716520000e-01f, 6.099320000e-01f, 3.482120000e-01f, 8.649200000e-02f, 1.448132000e+00f, 1.176812000e+00f, 9.054920000e-01f, 6.341720000e-01f, 3.628520000e-01f, 9.153200000e-02f,
                1.427220000e+00f, 1.157820000e+00f, 8.884200000e-01f, 6.190200000e-01f, 3.496200000e-01f, 8.022000000e-02f, 1.479620000e+00f, 1.200620000e+00f, 9.216200000e-01f, 6.426200000e-01f, 3.636200000e-01f, 8.462000000e-02f,
                1.558700000e+00f, 1.265300000e+00f, 9.719000000e-01f, 6.785000000e-01f, 3.851000000e-01f, 9.170000000e-02f, 1.637780000e+00f, 1.329980000e+00f, 1.022180000e+00f, 7.143800000e-01f, 4.065800000e-01f, 9.878000000e-02f,
                1.716860000e+00f, 1.394660000e+00f, 1.072460000e+00f, 7.502600000e-01f, 4.280600000e-01f, 1.058600000e-01f, 1.795940000e+00f, 1.459340000e+00f, 1.122740000e+00f, 7.861400000e-01f, 4.495400000e-01f, 1.129400000e-01f,
                1.875020000e+00f, 1.524020000e+00f, 1.173020000e+00f, 8.220200000e-01f, 4.710200000e-01f, 1.200200000e-01f, 1.954100000e+00f, 1.588700000e+00f, 1.223300000e+00f, 8.579000000e-01f, 4.925000000e-01f, 1.271000000e-01f,
                2.007140000e+00f, 1.632140000e+00f, 1.257140000e+00f, 8.821400000e-01f, 5.071400000e-01f, 1.321400000e-01f, 2.138940000e+00f, 1.739940000e+00f, 1.340940000e+00f, 9.419400000e-01f, 5.429400000e-01f, 1.439400000e-01f,
                2.191340000e+00f, 1.782740000e+00f, 1.374140000e+00f, 9.655400000e-01f, 5.569400000e-01f, 1.483400000e-01f, 2.270420000e+00f, 1.847420000e+00f, 1.424420000e+00f, 1.001420000e+00f, 5.784200000e-01f, 1.554200000e-01f,
                2.349500000e+00f, 1.912100000e+00f, 1.474700000e+00f, 1.037300000e+00f, 5.999000000e-01f, 1.625000000e-01f, 2.428580000e+00f, 1.976780000e+00f, 1.524980000e+00f, 1.073180000e+00f, 6.213800000e-01f, 1.695800000e-01f,
                2.507660000e+00f, 2.041460000e+00f, 1.575260000e+00f, 1.109060000e+00f, 6.428600000e-01f, 1.766600000e-01f, 2.586740000e+00f, 2.106140000e+00f, 1.625540000e+00f, 1.144940000e+00f, 6.643400000e-01f, 1.837400000e-01f,
                2.665820000e+00f, 2.170820000e+00f, 1.675820000e+00f, 1.180820000e+00f, 6.858200000e-01f, 1.908200000e-01f, 2.718860000e+00f, 2.214260000e+00f, 1.709660000e+00f, 1.205060000e+00f, 7.004600000e-01f, 1.958600000e-01f,
                2.850660000e+00f, 2.322060000e+00f, 1.793460000e+00f, 1.264860000e+00f, 7.362600000e-01f, 2.076600000e-01f, 2.903060000e+00f, 2.364860000e+00f, 1.826660000e+00f, 1.288460000e+00f, 7.502600000e-01f, 2.120600000e-01f,
                2.982140000e+00f, 2.429540000e+00f, 1.876940000e+00f, 1.324340000e+00f, 7.717400000e-01f, 2.191400000e-01f, 3.061220000e+00f, 2.494220000e+00f, 1.927220000e+00f, 1.360220000e+00f, 7.932200000e-01f, 2.262200000e-01f,
                3.140300000e+00f, 2.558900000e+00f, 1.977500000e+00f, 1.396100000e+00f, 8.147000000e-01f, 2.333000000e-01f, 3.219380000e+00f, 2.623580000e+00f, 2.027780000e+00f, 1.431980000e+00f, 8.361800000e-01f, 2.403800000e-01f,
                3.298460000e+00f, 2.688260000e+00f, 2.078060000e+00f, 1.467860000e+00f, 8.576600000e-01f, 2.474600000e-01f, 3.377540000e+00f, 2.752940000e+00f, 2.128340000e+00f, 1.503740000e+00f, 8.791400000e-01f, 2.545400000e-01f,
                3.430580000e+00f, 2.796380000e+00f, 2.162180000e+00f, 1.527980000e+00f, 8.937800000e-01f, 2.595800000e-01f, 3.562380000e+00f, 2.904180000e+00f, 2.245980000e+00f, 1.587780000e+00f, 9.295800000e-01f, 2.713800000e-01f,
                3.614780000e+00f, 2.946980000e+00f, 2.279180000e+00f, 1.611380000e+00f, 9.435800000e-01f, 2.757800000e-01f, 3.693860000e+00f, 3.011660000e+00f, 2.329460000e+00f, 1.647260000e+00f, 9.650600000e-01f, 2.828600000e-01f,
                3.772940000e+00f, 3.076340000e+00f, 2.379740000e+00f, 1.683140000e+00f, 9.865400000e-01f, 2.899400000e-01f, 3.852020000e+00f, 3.141020000e+00f, 2.430020000e+00f, 1.719020000e+00f, 1.008020000e+00f, 2.970200000e-01f,
                3.931100000e+00f, 3.205700000e+00f, 2.480300000e+00f, 1.754900000e+00f, 1.029500000e+00f, 3.041000000e-01f, 4.010180000e+00f, 3.270380000e+00f, 2.530580000e+00f, 1.790780000e+00f, 1.050980000e+00f, 3.111800000e-01f,
                4.089260000e+00f, 3.335060000e+00f, 2.580860000e+00f, 1.826660000e+00f, 1.072460000e+00f, 3.182600000e-01f, 4.142300000e+00f, 3.378500000e+00f, 2.614700000e+00f, 1.850900000e+00f, 1.087100000e+00f, 3.233000000e-01f,
                4.274100000e+00f, 3.486300000e+00f, 2.698500000e+00f, 1.910700000e+00f, 1.122900000e+00f, 3.351000000e-01f, 4.326500000e+00f, 3.529100000e+00f, 2.731700000e+00f, 1.934300000e+00f, 1.136900000e+00f, 3.395000000e-01f,
                4.405580000e+00f, 3.593780000e+00f, 2.781980000e+00f, 1.970180000e+00f, 1.158380000e+00f, 3.465800000e-01f, 4.484660000e+00f, 3.658460000e+00f, 2.832260000e+00f, 2.006060000e+00f, 1.179860000e+00f, 3.536600000e-01f,
                4.563740000e+00f, 3.723140000e+00f, 2.882540000e+00f, 2.041940000e+00f, 1.201340000e+00f, 3.607400000e-01f, 4.642820000e+00f, 3.787820000e+00f, 2.932820000e+00f, 2.077820000e+00f, 1.222820000e+00f, 3.678200000e-01f,
                4.721900000e+00f, 3.852500000e+00f, 2.983100000e+00f, 2.113700000e+00f, 1.244300000e+00f, 3.749000000e-01f, 4.800980000e+00f, 3.917180000e+00f, 3.033380000e+00f, 2.149580000e+00f, 1.265780000e+00f, 3.819800000e-01f,
                4.854020000e+00f, 3.960620000e+00f, 3.067220000e+00f, 2.173820000e+00f, 1.280420000e+00f, 3.870200000e-01f, 4.985820000e+00f, 4.068420000e+00f, 3.151020000e+00f, 2.233620000e+00f, 1.316220000e+00f, 3.988200000e-01f,
                5.038220000e+00f, 4.111220000e+00f, 3.184220000e+00f, 2.257220000e+00f, 1.330220000e+00f, 4.032200000e-01f, 5.117300000e+00f, 4.175900000e+00f, 3.234500000e+00f, 2.293100000e+00f, 1.351700000e+00f, 4.103000000e-01f,
                5.196380000e+00f, 4.240580000e+00f, 3.284780000e+00f, 2.328980000e+00f, 1.373180000e+00f, 4.173800000e-01f, 5.275460000e+00f, 4.305260000e+00f, 3.335060000e+00f, 2.364860000e+00f, 1.394660000e+00f, 4.244600000e-01f,
                5.354540000e+00f, 4.369940000e+00f, 3.385340000e+00f, 2.400740000e+00f, 1.416140000e+00f, 4.315400000e-01f, 5.433620000e+00f, 4.434620000e+00f, 3.435620000e+00f, 2.436620000e+00f, 1.437620000e+00f, 4.386200000e-01f,
                5.512700000e+00f, 4.499300000e+00f, 3.485900000e+00f, 2.472500000e+00f, 1.459100000e+00f, 4.457000000e-01f, 5.565740000e+00f, 4.542740000e+00f, 3.519740000e+00f, 2.496740000e+00f, 1.473740000e+00f, 4.507400000e-01f,
                5.697540000e+00f, 4.650540000e+00f, 3.603540000e+00f, 2.556540000e+00f, 1.509540000e+00f, 4.625400000e-01f, 5.749940000e+00f, 4.693340000e+00f, 3.636740000e+00f, 2.580140000e+00f, 1.523540000e+00f, 4.669400000e-01f,
                5.829020000e+00f, 4.758020000e+00f, 3.687020000e+00f, 2.616020000e+00f, 1.545020000e+00f, 4.740200000e-01f, 5.908100000e+00f, 4.822700000e+00f, 3.737300000e+00f, 2.651900000e+00f, 1.566500000e+00f, 4.811000000e-01f,
                5.987180000e+00f, 4.887380000e+00f, 3.787580000e+00f, 2.687780000e+00f, 1.587980000e+00f, 4.881800000e-01f, 6.066260000e+00f, 4.952060000e+00f, 3.837860000e+00f, 2.723660000e+00f, 1.609460000e+00f, 4.952600000e-01f,
                6.145340000e+00f, 5.016740000e+00f, 3.888140000e+00f, 2.759540000e+00f, 1.630940000e+00f, 5.023400000e-01f, 6.224420000e+00f, 5.081420000e+00f, 3.938420000e+00f, 2.795420000e+00f, 1.652420000e+00f, 5.094200000e-01f,
                6.277460000e+00f, 5.124860000e+00f, 3.972260000e+00f, 2.819660000e+00f, 1.667060000e+00f, 5.144600000e-01f, 6.409260000e+00f, 5.232660000e+00f, 4.056060000e+00f, 2.879460000e+00f, 1.702860000e+00f, 5.262600000e-01f,
                6.461660000e+00f, 5.275460000e+00f, 4.089260000e+00f, 2.903060000e+00f, 1.716860000e+00f, 5.306600000e-01f, 6.540740000e+00f, 5.340140000e+00f, 4.139540000e+00f, 2.938940000e+00f, 1.738340000e+00f, 5.377400000e-01f,
                6.619820000e+00f, 5.404820000e+00f, 4.189820000e+00f, 2.974820000e+00f, 1.759820000e+00f, 5.448200000e-01f, 6.698900000e+00f, 5.469500000e+00f, 4.240100000e+00f, 3.010700000e+00f, 1.781300000e+00f, 5.519000000e-01f,
                6.777980000e+00f, 5.534180000e+00f, 4.290380000e+00f, 3.046580000e+00f, 1.802780000e+00f, 5.589800000e-01f, 6.857060000e+00f, 5.598860000e+00f, 4.340660000e+00f, 3.082460000e+00f, 1.824260000e+00f, 5.660600000e-01f,
                6.936140000e+00f, 5.663540000e+00f, 4.390940000e+00f, 3.118340000e+00f, 1.845740000e+00f, 5.731400000e-01f, 6.989180000e+00f, 5.706980000e+00f, 4.424780000e+00f, 3.142580000e+00f, 1.860380000e+00f, 5.781800000e-01f,
                7.120980000e+00f, 5.814780000e+00f, 4.508580000e+00f, 3.202380000e+00f, 1.896180000e+00f, 5.899800000e-01f, 7.173380000e+00f, 5.857580000e+00f, 4.541780000e+00f, 3.225980000e+00f, 1.910180000e+00f, 5.943800000e-01f,
                7.252460000e+00f, 5.922260000e+00f, 4.592060000e+00f, 3.261860000e+00f, 1.931660000e+00f, 6.014600000e-01f, 7.331540000e+00f, 5.986940000e+00f, 4.642340000e+00f, 3.297740000e+00f, 1.953140000e+00f, 6.085400000e-01f,
                7.410620000e+00f, 6.051620000e+00f, 4.692620000e+00f, 3.333620000e+00f, 1.974620000e+00f, 6.156200000e-01f, 7.489700000e+00f, 6.116300000e+00f, 4.742900000e+00f, 3.369500000e+00f, 1.996100000e+00f, 6.227000000e-01f,
                7.568780000e+00f, 6.180980000e+00f, 4.793180000e+00f, 3.405380000e+00f, 2.017580000e+00f, 6.297800000e-01f, 7.647860000e+00f, 6.245660000e+00f, 4.843460000e+00f, 3.441260000e+00f, 2.039060000e+00f, 6.368600000e-01f,
                7.700900000e+00f, 6.289100000e+00f, 4.877300000e+00f, 3.465500000e+00f, 2.053700000e+00f, 6.419000000e-01f, 7.700724000e+00f, 6.290844000e+00f, 4.880964000e+00f, 3.471084000e+00f, 2.061204000e+00f, 6.513240000e-01f,
                7.753124000e+00f, 6.333644000e+00f, 4.914164000e+00f, 3.494684000e+00f, 2.075204000e+00f, 6.557240000e-01f, 7.832204000e+00f, 6.398324000e+00f, 4.964444000e+00f, 3.530564000e+00f, 2.096684000e+00f, 6.628040000e-01f,
                7.911284000e+00f, 6.463004000e+00f, 5.014724000e+00f, 3.566444000e+00f, 2.118164000e+00f, 6.698840000e-01f, 7.990364000e+00f, 6.527684000e+00f, 5.065004000e+00f, 3.602324000e+00f, 2.139644000e+00f, 6.769640000e-01f,
                8.069444000e+00f, 6.592364000e+00f, 5.115284000e+00f, 3.638204000e+00f, 2.161124000e+00f, 6.840440000e-01f, 8.148524000e+00f, 6.657044000e+00f, 5.165564000e+00f, 3.674084000e+00f, 2.182604000e+00f, 6.911240000e-01f,
                8.227604000e+00f, 6.721724000e+00f, 5.215844000e+00f, 3.709964000e+00f, 2.204084000e+00f, 6.982040000e-01f, 8.280644000e+00f, 6.765164000e+00f, 5.249684000e+00f, 3.734204000e+00f, 2.218724000e+00f, 7.032440000e-01f,
                8.143308000e+00f, 6.655668000e+00f, 5.168028000e+00f, 3.680388000e+00f, 2.192748000e+00f, 7.051080000e-01f, 8.195708000e+00f, 6.698468000e+00f, 5.201228000e+00f, 3.703988000e+00f, 2.206748000e+00f, 7.095080000e-01f,
                8.274788000e+00f, 6.763148000e+00f, 5.251508000e+00f, 3.739868000e+00f, 2.228228000e+00f, 7.165880000e-01f, 8.353868000e+00f, 6.827828000e+00f, 5.301788000e+00f, 3.775748000e+00f, 2.249708000e+00f, 7.236680000e-01f,
                8.432948000e+00f, 6.892508000e+00f, 5.352068000e+00f, 3.811628000e+00f, 2.271188000e+00f, 7.307480000e-01f, 8.512028000e+00f, 6.957188000e+00f, 5.402348000e+00f, 3.847508000e+00f, 2.292668000e+00f, 7.378280000e-01f,
                8.591108000e+00f, 7.021868000e+00f, 5.452628000e+00f, 3.883388000e+00f, 2.314148000e+00f, 7.449080000e-01f, 8.670188000e+00f, 7.086548000e+00f, 5.502908000e+00f, 3.919268000e+00f, 2.335628000e+00f, 7.519880000e-01f,
                8.723228000e+00f, 7.129988000e+00f, 5.536748000e+00f, 3.943508000e+00f, 2.350268000e+00f, 7.570280000e-01f, 9.709092000e+00f, 7.936332000e+00f, 6.163572000e+00f, 4.390812000e+00f, 2.618052000e+00f, 8.452920000e-01f,
                9.761492000e+00f, 7.979132000e+00f, 6.196772000e+00f, 4.414412000e+00f, 2.632052000e+00f, 8.496920000e-01f, 9.840572000e+00f, 8.043812000e+00f, 6.247052000e+00f, 4.450292000e+00f, 2.653532000e+00f, 8.567720000e-01f,
                9.919652000e+00f, 8.108492000e+00f, 6.297332000e+00f, 4.486172000e+00f, 2.675012000e+00f, 8.638520000e-01f, 9.998732000e+00f, 8.173172000e+00f, 6.347612000e+00f, 4.522052000e+00f, 2.696492000e+00f, 8.709320000e-01f,
                1.007781200e+01f, 8.237852000e+00f, 6.397892000e+00f, 4.557932000e+00f, 2.717972000e+00f, 8.780120000e-01f, 1.015689200e+01f, 8.302532000e+00f, 6.448172000e+00f, 4.593812000e+00f, 2.739452000e+00f, 8.850920000e-01f,
                1.023597200e+01f, 8.367212000e+00f, 6.498452000e+00f, 4.629692000e+00f, 2.760932000e+00f, 8.921720000e-01f, 1.028901200e+01f, 8.410652000e+00f, 6.532292000e+00f, 4.653932000e+00f, 2.775572000e+00f, 8.972120000e-01f,
                1.012057200e+01f, 8.270052000e+00f, 6.419532000e+00f, 4.569012000e+00f, 2.718492000e+00f, 8.679720000e-01f, 1.017297200e+01f, 8.312852000e+00f, 6.452732000e+00f, 4.592612000e+00f, 2.732492000e+00f, 8.723720000e-01f,
                1.025205200e+01f, 8.377532000e+00f, 6.503012000e+00f, 4.628492000e+00f, 2.753972000e+00f, 8.794520000e-01f, 1.033113200e+01f, 8.442212000e+00f, 6.553292000e+00f, 4.664372000e+00f, 2.775452000e+00f, 8.865320000e-01f,
                1.041021200e+01f, 8.506892000e+00f, 6.603572000e+00f, 4.700252000e+00f, 2.796932000e+00f, 8.936120000e-01f, 1.048929200e+01f, 8.571572000e+00f, 6.653852000e+00f, 4.736132000e+00f, 2.818412000e+00f, 9.006920000e-01f,
                1.056837200e+01f, 8.636252000e+00f, 6.704132000e+00f, 4.772012000e+00f, 2.839892000e+00f, 9.077720000e-01f, 1.064745200e+01f, 8.700932000e+00f, 6.754412000e+00f, 4.807892000e+00f, 2.861372000e+00f, 9.148520000e-01f,
                1.070049200e+01f, 8.744372000e+00f, 6.788252000e+00f, 4.832132000e+00f, 2.876012000e+00f, 9.198920000e-01f, 1.067958000e+01f, 8.725380000e+00f, 6.771180000e+00f, 4.816980000e+00f, 2.862780000e+00f, 9.085800000e-01f,
                1.073198000e+01f, 8.768180000e+00f, 6.804380000e+00f, 4.840580000e+00f, 2.876780000e+00f, 9.129800000e-01f, 1.081106000e+01f, 8.832860000e+00f, 6.854660000e+00f, 4.876460000e+00f, 2.898260000e+00f, 9.200600000e-01f,
                1.089014000e+01f, 8.897540000e+00f, 6.904940000e+00f, 4.912340000e+00f, 2.919740000e+00f, 9.271400000e-01f, 1.096922000e+01f, 8.962220000e+00f, 6.955220000e+00f, 4.948220000e+00f, 2.941220000e+00f, 9.342200000e-01f,
                1.104830000e+01f, 9.026900000e+00f, 7.005500000e+00f, 4.984100000e+00f, 2.962700000e+00f, 9.413000000e-01f, 1.112738000e+01f, 9.091580000e+00f, 7.055780000e+00f, 5.019980000e+00f, 2.984180000e+00f, 9.483800000e-01f,
                1.120646000e+01f, 9.156260000e+00f, 7.106060000e+00f, 5.055860000e+00f, 3.005660000e+00f, 9.554600000e-01f, 1.125950000e+01f, 9.199700000e+00f, 7.139900000e+00f, 5.080100000e+00f, 3.020300000e+00f, 9.605000000e-01f,
                1.139130000e+01f, 9.307500000e+00f, 7.223700000e+00f, 5.139900000e+00f, 3.056100000e+00f, 9.723000000e-01f, 1.144370000e+01f, 9.350300000e+00f, 7.256900000e+00f, 5.163500000e+00f, 3.070100000e+00f, 9.767000000e-01f,
                1.152278000e+01f, 9.414980000e+00f, 7.307180000e+00f, 5.199380000e+00f, 3.091580000e+00f, 9.837800000e-01f, 1.160186000e+01f, 9.479660000e+00f, 7.357460000e+00f, 5.235260000e+00f, 3.113060000e+00f, 9.908600000e-01f,
                1.168094000e+01f, 9.544340000e+00f, 7.407740000e+00f, 5.271140000e+00f, 3.134540000e+00f, 9.979400000e-01f, 1.176002000e+01f, 9.609020000e+00f, 7.458020000e+00f, 5.307020000e+00f, 3.156020000e+00f, 1.005020000e+00f,
                1.183910000e+01f, 9.673700000e+00f, 7.508300000e+00f, 5.342900000e+00f, 3.177500000e+00f, 1.012100000e+00f, 1.191818000e+01f, 9.738380000e+00f, 7.558580000e+00f, 5.378780000e+00f, 3.198980000e+00f, 1.019180000e+00f,
                1.197122000e+01f, 9.781820000e+00f, 7.592420000e+00f, 5.403020000e+00f, 3.213620000e+00f, 1.024220000e+00f, 1.210302000e+01f, 9.889620000e+00f, 7.676220000e+00f, 5.462820000e+00f, 3.249420000e+00f, 1.036020000e+00f,
                1.215542000e+01f, 9.932420000e+00f, 7.709420000e+00f, 5.486420000e+00f, 3.263420000e+00f, 1.040420000e+00f, 1.223450000e+01f, 9.997100000e+00f, 7.759700000e+00f, 5.522300000e+00f, 3.284900000e+00f, 1.047500000e+00f,
                1.231358000e+01f, 1.006178000e+01f, 7.809980000e+00f, 5.558180000e+00f, 3.306380000e+00f, 1.054580000e+00f, 1.239266000e+01f, 1.012646000e+01f, 7.860260000e+00f, 5.594060000e+00f, 3.327860000e+00f, 1.061660000e+00f,
                1.247174000e+01f, 1.019114000e+01f, 7.910540000e+00f, 5.629940000e+00f, 3.349340000e+00f, 1.068740000e+00f, 1.255082000e+01f, 1.025582000e+01f, 7.960820000e+00f, 5.665820000e+00f, 3.370820000e+00f, 1.075820000e+00f,
                1.262990000e+01f, 1.032050000e+01f, 8.011100000e+00f, 5.701700000e+00f, 3.392300000e+00f, 1.082900000e+00f, 1.268294000e+01f, 1.036394000e+01f, 8.044940000e+00f, 5.725940000e+00f, 3.406940000e+00f, 1.087940000e+00f,
                1.281474000e+01f, 1.047174000e+01f, 8.128740000e+00f, 5.785740000e+00f, 3.442740000e+00f, 1.099740000e+00f, 1.286714000e+01f, 1.051454000e+01f, 8.161940000e+00f, 5.809340000e+00f, 3.456740000e+00f, 1.104140000e+00f,
                1.294622000e+01f, 1.057922000e+01f, 8.212220000e+00f, 5.845220000e+00f, 3.478220000e+00f, 1.111220000e+00f, 1.302530000e+01f, 1.064390000e+01f, 8.262500000e+00f, 5.881100000e+00f, 3.499700000e+00f, 1.118300000e+00f,
                1.310438000e+01f, 1.070858000e+01f, 8.312780000e+00f, 5.916980000e+00f, 3.521180000e+00f, 1.125380000e+00f, 1.318346000e+01f, 1.077326000e+01f, 8.363060000e+00f, 5.952860000e+00f, 3.542660000e+00f, 1.132460000e+00f,
                1.326254000e+01f, 1.083794000e+01f, 8.413340000e+00f, 5.988740000e+00f, 3.564140000e+00f, 1.139540000e+00f, 1.334162000e+01f, 1.090262000e+01f, 8.463620000e+00f, 6.024620000e+00f, 3.585620000e+00f, 1.146620000e+00f,
                1.339466000e+01f, 1.094606000e+01f, 8.497460000e+00f, 6.048860000e+00f, 3.600260000e+00f, 1.151660000e+00f, 1.352646000e+01f, 1.105386000e+01f, 8.581260000e+00f, 6.108660000e+00f, 3.636060000e+00f, 1.163460000e+00f,
                1.357886000e+01f, 1.109666000e+01f, 8.614460000e+00f, 6.132260000e+00f, 3.650060000e+00f, 1.167860000e+00f, 1.365794000e+01f, 1.116134000e+01f, 8.664740000e+00f, 6.168140000e+00f, 3.671540000e+00f, 1.174940000e+00f,
                1.373702000e+01f, 1.122602000e+01f, 8.715020000e+00f, 6.204020000e+00f, 3.693020000e+00f, 1.182020000e+00f, 1.381610000e+01f, 1.129070000e+01f, 8.765300000e+00f, 6.239900000e+00f, 3.714500000e+00f, 1.189100000e+00f,
                1.389518000e+01f, 1.135538000e+01f, 8.815580000e+00f, 6.275780000e+00f, 3.735980000e+00f, 1.196180000e+00f, 1.397426000e+01f, 1.142006000e+01f, 8.865860000e+00f, 6.311660000e+00f, 3.757460000e+00f, 1.203260000e+00f,
                1.405334000e+01f, 1.148474000e+01f, 8.916140000e+00f, 6.347540000e+00f, 3.778940000e+00f, 1.210340000e+00f, 1.410638000e+01f, 1.152818000e+01f, 8.949980000e+00f, 6.371780000e+00f, 3.793580000e+00f, 1.215380000e+00f,
                1.423818000e+01f, 1.163598000e+01f, 9.033780000e+00f, 6.431580000e+00f, 3.829380000e+00f, 1.227180000e+00f, 1.429058000e+01f, 1.167878000e+01f, 9.066980000e+00f, 6.455180000e+00f, 3.843380000e+00f, 1.231580000e+00f,
                1.436966000e+01f, 1.174346000e+01f, 9.117260000e+00f, 6.491060000e+00f, 3.864860000e+00f, 1.238660000e+00f, 1.444874000e+01f, 1.180814000e+01f, 9.167540000e+00f, 6.526940000e+00f, 3.886340000e+00f, 1.245740000e+00f,
                1.452782000e+01f, 1.187282000e+01f, 9.217820000e+00f, 6.562820000e+00f, 3.907820000e+00f, 1.252820000e+00f, 1.460690000e+01f, 1.193750000e+01f, 9.268100000e+00f, 6.598700000e+00f, 3.929300000e+00f, 1.259900000e+00f,
                1.468598000e+01f, 1.200218000e+01f, 9.318380000e+00f, 6.634580000e+00f, 3.950780000e+00f, 1.266980000e+00f, 1.476506000e+01f, 1.206686000e+01f, 9.368660000e+00f, 6.670460000e+00f, 3.972260000e+00f, 1.274060000e+00f,
                1.481810000e+01f, 1.211030000e+01f, 9.402500000e+00f, 6.694700000e+00f, 3.986900000e+00f, 1.279100000e+00f, 1.494990000e+01f, 1.221810000e+01f, 9.486300000e+00f, 6.754500000e+00f, 4.022700000e+00f, 1.290900000e+00f,
                1.500230000e+01f, 1.226090000e+01f, 9.519500000e+00f, 6.778100000e+00f, 4.036700000e+00f, 1.295300000e+00f, 1.508138000e+01f, 1.232558000e+01f, 9.569780000e+00f, 6.813980000e+00f, 4.058180000e+00f, 1.302380000e+00f,
                1.516046000e+01f, 1.239026000e+01f, 9.620060000e+00f, 6.849860000e+00f, 4.079660000e+00f, 1.309460000e+00f, 1.523954000e+01f, 1.245494000e+01f, 9.670340000e+00f, 6.885740000e+00f, 4.101140000e+00f, 1.316540000e+00f,
                1.531862000e+01f, 1.251962000e+01f, 9.720620000e+00f, 6.921620000e+00f, 4.122620000e+00f, 1.323620000e+00f, 1.539770000e+01f, 1.258430000e+01f, 9.770900000e+00f, 6.957500000e+00f, 4.144100000e+00f, 1.330700000e+00f,
                1.547678000e+01f, 1.264898000e+01f, 9.821180000e+00f, 6.993380000e+00f, 4.165580000e+00f, 1.337780000e+00f, 1.552982000e+01f, 1.269242000e+01f, 9.855020000e+00f, 7.017620000e+00f, 4.180220000e+00f, 1.342820000e+00f,
                1.566162000e+01f, 1.280022000e+01f, 9.938820000e+00f, 7.077420000e+00f, 4.216020000e+00f, 1.354620000e+00f, 1.571402000e+01f, 1.284302000e+01f, 9.972020000e+00f, 7.101020000e+00f, 4.230020000e+00f, 1.359020000e+00f,
                1.579310000e+01f, 1.290770000e+01f, 1.002230000e+01f, 7.136900000e+00f, 4.251500000e+00f, 1.366100000e+00f, 1.587218000e+01f, 1.297238000e+01f, 1.007258000e+01f, 7.172780000e+00f, 4.272980000e+00f, 1.373180000e+00f,
                1.595126000e+01f, 1.303706000e+01f, 1.012286000e+01f, 7.208660000e+00f, 4.294460000e+00f, 1.380260000e+00f, 1.603034000e+01f, 1.310174000e+01f, 1.017314000e+01f, 7.244540000e+00f, 4.315940000e+00f, 1.387340000e+00f,
                1.610942000e+01f, 1.316642000e+01f, 1.022342000e+01f, 7.280420000e+00f, 4.337420000e+00f, 1.394420000e+00f, 1.618850000e+01f, 1.323110000e+01f, 1.027370000e+01f, 7.316300000e+00f, 4.358900000e+00f, 1.401500000e+00f,
                1.624154000e+01f, 1.327454000e+01f, 1.030754000e+01f, 7.340540000e+00f, 4.373540000e+00f, 1.406540000e+00f, 1.637334000e+01f, 1.338234000e+01f, 1.039134000e+01f, 7.400340000e+00f, 4.409340000e+00f, 1.418340000e+00f,
                1.642574000e+01f, 1.342514000e+01f, 1.042454000e+01f, 7.423940000e+00f, 4.423340000e+00f, 1.422740000e+00f, 1.650482000e+01f, 1.348982000e+01f, 1.047482000e+01f, 7.459820000e+00f, 4.444820000e+00f, 1.429820000e+00f,
                1.658390000e+01f, 1.355450000e+01f, 1.052510000e+01f, 7.495700000e+00f, 4.466300000e+00f, 1.436900000e+00f, 1.666298000e+01f, 1.361918000e+01f, 1.057538000e+01f, 7.531580000e+00f, 4.487780000e+00f, 1.443980000e+00f,
                1.674206000e+01f, 1.368386000e+01f, 1.062566000e+01f, 7.567460000e+00f, 4.509260000e+00f, 1.451060000e+00f, 1.682114000e+01f, 1.374854000e+01f, 1.067594000e+01f, 7.603340000e+00f, 4.530740000e+00f, 1.458140000e+00f,
                1.690022000e+01f, 1.381322000e+01f, 1.072622000e+01f, 7.639220000e+00f, 4.552220000e+00f, 1.465220000e+00f, 1.695326000e+01f, 1.385666000e+01f, 1.076006000e+01f, 7.663460000e+00f, 4.566860000e+00f, 1.470260000e+00f,
                1.695308400e+01f, 1.385840400e+01f, 1.076372400e+01f, 7.669044000e+00f, 4.574364000e+00f, 1.479684000e+00f, 1.700548400e+01f, 1.390120400e+01f, 1.079692400e+01f, 7.692644000e+00f, 4.588364000e+00f, 1.484084000e+00f,
                1.708456400e+01f, 1.396588400e+01f, 1.084720400e+01f, 7.728524000e+00f, 4.609844000e+00f, 1.491164000e+00f, 1.716364400e+01f, 1.403056400e+01f, 1.089748400e+01f, 7.764404000e+00f, 4.631324000e+00f, 1.498244000e+00f,
                1.724272400e+01f, 1.409524400e+01f, 1.094776400e+01f, 7.800284000e+00f, 4.652804000e+00f, 1.505324000e+00f, 1.732180400e+01f, 1.415992400e+01f, 1.099804400e+01f, 7.836164000e+00f, 4.674284000e+00f, 1.512404000e+00f,
                1.740088400e+01f, 1.422460400e+01f, 1.104832400e+01f, 7.872044000e+00f, 4.695764000e+00f, 1.519484000e+00f, 1.747996400e+01f, 1.428928400e+01f, 1.109860400e+01f, 7.907924000e+00f, 4.717244000e+00f, 1.526564000e+00f,
                1.753300400e+01f, 1.433272400e+01f, 1.113244400e+01f, 7.932164000e+00f, 4.731884000e+00f, 1.531604000e+00f, 1.739566800e+01f, 1.422322800e+01f, 1.105078800e+01f, 7.878348000e+00f, 4.705908000e+00f, 1.533468000e+00f,
                1.744806800e+01f, 1.426602800e+01f, 1.108398800e+01f, 7.901948000e+00f, 4.719908000e+00f, 1.537868000e+00f, 1.752714800e+01f, 1.433070800e+01f, 1.113426800e+01f, 7.937828000e+00f, 4.741388000e+00f, 1.544948000e+00f,
                1.760622800e+01f, 1.439538800e+01f, 1.118454800e+01f, 7.973708000e+00f, 4.762868000e+00f, 1.552028000e+00f, 1.768530800e+01f, 1.446006800e+01f, 1.123482800e+01f, 8.009588000e+00f, 4.784348000e+00f, 1.559108000e+00f,
                1.776438800e+01f, 1.452474800e+01f, 1.128510800e+01f, 8.045468000e+00f, 4.805828000e+00f, 1.566188000e+00f, 1.784346800e+01f, 1.458942800e+01f, 1.133538800e+01f, 8.081348000e+00f, 4.827308000e+00f, 1.573268000e+00f,
                1.792254800e+01f, 1.465410800e+01f, 1.138566800e+01f, 8.117228000e+00f, 4.848788000e+00f, 1.580348000e+00f, 1.797558800e+01f, 1.469754800e+01f, 1.141950800e+01f, 8.141468000e+00f, 4.863428000e+00f, 1.585388000e+00f,
            };

            float[] y_actual = y.ToFloatArray();

            AssertError.Tolerance(y_expect, y_actual, 1e-10f, 1e-5f);
        }
    }
}
